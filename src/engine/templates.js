// =============================================================================
// GLP-1 SOAP Engine Templates — FROZEN
// Do NOT modify this file. This is the canonical template logic.
// UI restructuring only — all changes belong in components/, not here.
// =============================================================================

export const SOAP_TEMPLATES = {
  初回: {
    default: {
      S: '初めてGLP-1受容体作動薬（{drug}）の使用を開始する。注射指導を実施済み。患者は注射に対して{patient_feeling}を示している。',
      O: '体重：{weight}kg　BMI：{bmi}\nHbA1c：{hba1c}%　eGFR：{egfr}\n開始薬剤：{drug}　開始用量：{dose}',
      A: 'GLP-1受容体作動薬導入。注射手技の習得を確認済み。消化器症状などの副作用モニタリングが必要。',
      P: '・用法用量の再確認（{dose}、{frequency}）\n・副作用（嘔気、下痢、便秘、注射部位反応）の説明実施\n・次回受診時に注射手技を確認する\n・自己血糖測定を継続',
    },
  },

  増量: {
    予定通り: {
      S: '副作用なく経過。{drug} {current_dose}→{new_dose}に増量予定。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\nHbA1c：{hba1c}%\n副作用の訴えなし',
      A: '増量基準を満たしており、予定通り増量。継続して副作用モニタリングを行う。',
      P: '・{drug} {new_dose}に増量\n・増量後の副作用（嘔気増強等）に注意するよう説明\n・次回受診まで血糖記録を継続',
    },
    慎重増量: {
      S: '軽度の副作用（{side_effect}）はあるが、患者は継続希望。慎重に増量を検討。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n軽度{side_effect}あり、日常生活への影響は軽微',
      A: '副作用が軽度であり、患者の希望と効果を考慮して慎重増量とする。',
      P: '・{drug} {new_dose}に慎重増量\n・副作用増強時はすぐに連絡するよう指導\n・必要に応じて減量または中止を検討',
    },
  },

  減量: {
    副作用による: {
      S: '{side_effect}の訴えがあり、{drug} {current_dose}から{new_dose}へ減量を検討。',
      O: '体重：{weight}kg\n{side_effect}の程度：{severity}\nバイタル：{vitals}',
      A: '副作用による減量が必要と判断。減量後の効果維持を確認する。',
      P: '・{drug} {new_dose}に減量\n・副作用が改善するか経過観察\n・改善後の再増量を検討\n・重篤な副作用の場合は中止も考慮',
    },
    患者希望: {
      S: '患者より副作用（{side_effect}）が気になるため減量希望あり。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\nHbA1c：{hba1c}%',
      A: '患者希望による減量。効果が維持できるか継続してモニタリングする。',
      P: '・患者希望により{drug} {new_dose}に減量\n・血糖コントロールの悪化がないか確認\n・体重変化をモニタリング',
    },
  },

  副作用なし: {
    default: {
      S: '特に副作用の訴えなく経過良好。{drug}継続使用中。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\nHbA1c：{hba1c}%\n消化器症状：なし　注射部位：問題なし',
      A: '副作用なく良好に経過。現用量で継続可能。',
      P: '・{drug} {dose}継続\n・定期的な体重・HbA1c測定を継続\n・副作用出現時は受診を指導',
    },
  },

  副作用あり: {
    嘔気嘔吐: {
      S: '嘔気{severity}あり。嘔吐は{vomiting}。食事摂取量の低下あり。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\n嘔気スコア：{score}\n食事摂取量：{meal_intake}',
      A: 'GLP-1による消化器症状（嘔気・嘔吐）。減量または対症療法を検討。',
      P: '・消化器症状への対応を説明（食事を少量に分ける、脂肪分を控える）\n・必要に応じて制吐剤の処方を医師に相談\n・重篤な場合は減量または中止を検討\n・脱水に注意',
    },
    下痢: {
      S: '下痢（{frequency}回/日）あり。{drug}開始後から継続している。',
      O: '体重：{weight}kg\n排便回数：{frequency}回/日　性状：{stool_type}\n脱水徴候：{dehydration}',
      A: 'GLP-1による下痢症状。電解質バランス・脱水に注意が必要。',
      P: '・水分・電解質の補充を指導\n・食事内容の見直し（脂肪分・刺激物を控える）\n・整腸剤・止瀉薬の使用を検討\n・改善なければ減量を考慮',
    },
    便秘: {
      S: '便秘あり（{frequency}日に1回）。腹部不快感の訴えあり。',
      O: '体重：{weight}kg\n排便回数：{frequency}日に1回\n腹部症状：{abdominal_symptoms}',
      A: 'GLP-1による消化管蠕動低下による便秘。生活指導と必要に応じて緩下剤を検討。',
      P: '・水分摂取増加を指導（2L/日目安）\n・食物繊維の摂取を勧める\n・適度な運動を指導\n・緩下剤の使用を検討\n・腸閉塞様症状に注意',
    },
    食欲不振: {
      S: '食欲不振あり。食事摂取量が{meal_intake}程度に低下。体重減少あり。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\n食事摂取量：{meal_intake}\nBMI：{bmi}',
      A: 'GLP-1による食欲抑制効果による食欲不振。栄養状態のモニタリングが必要。',
      P: '・少量頻回食を指導\n・たんぱく質・ビタミンの摂取を意識するよう説明\n・栄養状態が悪化する場合は減量を検討\n・BMI低下に注意',
    },
    注射部位反応: {
      S: '注射部位に{reaction}あり。注射手技の確認を実施。',
      O: '注射部位：{injection_site}\n反応の程度：{severity}\n注射手技：{technique_assessment}',
      A: '注射部位反応あり。手技指導と部位のローテーション指導が必要。',
      P: '・注射部位のローテーション方法を再指導\n・同一部位への連続注射を避けるよう説明\n・注射後の揉みほぐしを避けるよう指導\n・硬結や潰瘍形成がある場合は皮膚科受診を検討',
    },
    その他副作用: {
      S: '{other_side_effect}の訴えあり。{drug}との因果関係を確認する。',
      O: '体重：{weight}kg\n症状：{other_side_effect}\n発現時期：{onset}',
      A: '{other_side_effect}とGLP-1との関連を評価。必要に応じて医師に報告。',
      P: '・症状の経過を観察\n・医師への報告を検討\n・副作用報告（PMDA）を検討\n・必要に応じて中止または減量',
    },
  },

  CP良: {
    default: {
      S: '自己注射を継続できている。用法用量を正しく理解・実施している。',
      O: '体重：{weight}kg　前回比：{weight_change}kg\nHbA1c：{hba1c}%\n残薬確認：適切',
      A: 'コンプライアンス良好。現状維持で継続。',
      P: '・{drug} {dose}継続\n・良好なコンプライアンスを維持するよう動機づけ\n・定期フォローを継続',
    },
  },

  CP不良: {
    注射忘れ: {
      S: '注射忘れがあり（週に{frequency}回程度）。理由：{reason}。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n残薬：{remaining_dose}',
      A: '注射忘れによるコンプライアンス不良。忘れた場合の対応と改善策が必要。',
      P: '・注射忘れ時の対応を説明（気づいたらすぐ打つ、次回の注射との間隔に注意）\n・アラーム設定等の工夫を提案\n・注射日を固定することを勧める\n・必要に応じて週1回製剤への変更を検討',
    },
    用法間違い: {
      S: '用法の誤りあり。{error_detail}。患者の理解度を再確認。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n理解度評価：{comprehension}',
      A: '用法の誤りによりコンプライアンス不良。再指導が必要。',
      P: '・用法用量を改めて丁寧に指導\n・文書による説明資料を提供\n・次回受診時に理解度を再確認\n・必要に応じて家族への説明を実施',
    },
    コスト問題: {
      S: '費用負担が大きく継続困難との訴えあり。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n現在の自己負担額：{cost}',
      A: 'コスト問題によるコンプライアンス不良。費用軽減策の提案が必要。',
      P: '・後発品への変更可能性を確認\n・高額療養費制度の説明\n・ジェネリック医薬品の情報提供\n・医師と相談の上、代替薬の検討',
    },
  },

  終了: {
    目標達成: {
      S: '目標体重・血糖コントロールを達成。患者・医師合意の上で終了を検討。',
      O: '体重：{weight}kg（目標：{target_weight}kg）\nHbA1c：{hba1c}%（目標：{target_hba1c}%）\nBMI：{bmi}',
      A: '治療目標達成により終了適応。終了後のリバウンド予防が重要。',
      P: '・{drug}終了\n・食事・運動療法の継続を強調\n・体重・血糖の定期モニタリングを継続\n・再開の基準について説明\n・リバウンド時の早期受診を指導',
    },
    副作用による終了: {
      S: '副作用（{side_effect}）が継続・重篤であり、継続困難と判断。',
      O: '副作用の程度：{severity}\n体重：{weight}kg\nHbA1c：{hba1c}%',
      A: '副作用により継続不可能と判断。代替療法の検討が必要。',
      P: '・{drug}中止\n・副作用症状の経過観察\n・代替薬（SGLT2阻害薬等）の検討を医師に相談\n・副作用報告を検討',
    },
    患者希望: {
      S: '患者希望により終了。理由：{reason}。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%',
      A: '患者希望による終了。治療継続の意義を説明した上で患者の意思を尊重。',
      P: '・{drug}終了\n・生活習慣の維持を継続して指導\n・定期的なフォローアップを継続\n・再開の選択肢があることを説明',
    },
    効果不十分: {
      S: '期待される効果が得られていない。体重・HbA1cの改善が不十分。',
      O: '体重：{weight}kg（開始時：{initial_weight}kg）\nHbA1c：{hba1c}%（開始時：{initial_hba1c}%）\n治療期間：{duration}',
      A: '効果不十分により終了または代替療法への変更を検討。',
      P: '・効果不十分の評価\n・代替薬または追加薬の検討を医師に相談\n・生活習慣の再評価\n・食事・運動療法の強化',
    },
  },

  自己調整: {
    増量した: {
      S: '患者が自己判断で{drug}を{dose}に増量していた。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n現在の用量（患者自己申告）：{dose}',
      A: '自己判断による増量。適切な用量と自己調整の危険性について説明が必要。',
      P: '・自己判断での増量は危険であることを説明\n・処方された用量に戻すよう指導\n・用量変更は必ず医師・薬剤師に相談するよう説明\n・次回受診を早める',
    },
    減量した: {
      S: '患者が自己判断で{drug}を{dose}に減量していた。理由：{reason}。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n現在の用量（患者自己申告）：{dose}',
      A: '自己判断による減量。理由を確認し適切な対応を検討。',
      P: '・自己減量の理由を確認し対応（副作用→対症療法、費用→制度案内）\n・処方用量の重要性を説明\n・自己判断での調整を行わないよう指導\n・医師に状況を報告',
    },
    中断した: {
      S: '患者が自己判断で{drug}を{duration}間中断していた。理由：{reason}。',
      O: '体重：{weight}kg\nHbA1c：{hba1c}%\n中断期間：{duration}',
      A: '自己中断あり。再開方法と中断理由への対応が必要。',
      P: '・再開時の用量（初回用量から再開するか確認）を医師に確認\n・中断理由に応じた対策を講じる\n・自己中断しないよう指導\n・次回受診を早める',
    },
  },

  その他: {
    フリーテキスト: {
      S: '',
      O: '',
      A: '',
      P: '',
    },
  },
}

// Helper: resolve a template by primary and secondary keys
export function getTemplate(primary, secondary) {
  const group = SOAP_TEMPLATES[primary]
  if (!group) return null
  return group[secondary] ?? group['default'] ?? null
}
